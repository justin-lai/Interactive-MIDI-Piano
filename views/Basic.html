<!DOCTYPE html>
<html xmlns = "http://www.w3.org/1999/xhtml" ng-app="MIDIPlayer">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="../styles/style.css" />
	<!-- polyfill -->
	<script src="../inc/shim/Base64.js" type="text/javascript"></script>
	<script src="../inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="../inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<!-- midi.js package -->
	<script src="../js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="../js/midi/gm.js" type="text/javascript"></script>
	<script src="../js/midi/loader.js" type="text/javascript"></script>
	<script src="../js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="../js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="../js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<script src="../js/midi/player.js" type="text/javascript"></script>

	<!-- utils -->
	<script src="../js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="../js/util/dom_request_script.js" type="text/javascript"></script>
	<!-- lib -->
	<script src="../lib/angular.min.js" type="text/javascript"></script>
	<script src="../lib/jquery.min.js" type="text/javascript"></script>

	<!-- player -->
	<script src="../app/player.js" type="text/javascript"></script>
	<script src="../app/services/services.js" type="text/javascript"></script>
	<script src="../app/keys/keys.js" type="text/javascript"></script>

	<!-- jasmid -->
	<script src="../inc/jasmid/stream.js"></script>
	<script src="../inc/jasmid/midifile.js"></script>
	<script src="../inc/jasmid/replayer.js"></script>

	<!-- shim -->
	<!-- <script src="../inc/shim/Base64.js" type="text/javascript"></script>
	<script src="../inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="../inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<script src="../inc/shim/WebMIDIAPI.js" type="text/javascript"></script> -->
</head>

<body ng-controller="KeysController" ng-keydown="keydown($event)" ng-keyup="keyup($event)">
	<form action="/">
		Note Duration: <input type="text" class="noteDuration" value=".75"><br>
		Note Delay: <input type="text" class="noteDelay" value="0"><br>
		Note Velocity: <input type="text" class="noteVelocity" value="127"><br>
	</form>

	<div id="piano">
		<div class="keys" ng-repeat="key in data.keys">
			<div id="{{key}}" ng-class="keyColor(key)" ng-mousedown="playNote(key)">
				<span>{{key}}</span>
			</div>
		</div>
	</div>

	<script type="text/javascript">

	window.onload = function () {
		MIDI.loadPlugin({
			soundfontUrl: "./examples/soundfont/",
			instrument: "acoustic_grand_piano",
		
      onsuccess: function() {
      	MIDI.Player.timeWarp = 1;
        MIDI.Player.loadFile("../examples/howls.mid", function() {
        	MIDI.Player.start();
        	MIDI.Player.addListener(function(data) {
        		var note = MIDI.noteToKey[data.note];

        		// var pianoKey = data.note - 21;
        		// var d = colorElements[pianoKey];
        		// if (d) {
        			if (data.message === 144) {
      					$('#'+note).addClass('pressed');
        				// var map = colorMap[data.note - 27];
        				// if (map) d.style.background = map.hex;
        				// d.style.color = "#fff";
        			} else {
      					$('#'+note).removeClass('pressed');

        				// d.style.background = "";
        				// d.style.color = "";
        			}
        		// }
        	});
      	});
      }
  	});
		// console.log(MIDI.noteToKey);
	};

	</script>
</body>
</html>